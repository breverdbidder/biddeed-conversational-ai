<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BidDeed.AI - Brevard County Foreclosure Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#0f172a;color:#e2e8f0}
.header{background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #334155;position:relative;z-index:1000}
.logo{display:flex;align-items:center;gap:.75rem}.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,#38bdf8,#818cf8);border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.25rem}
.logo-text{font-size:1.5rem;font-weight:700;background:linear-gradient(135deg,#38bdf8,#818cf8);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.nav{display:flex;gap:1.5rem}.nav a{color:#94a3b8;text-decoration:none;font-weight:500;transition:color .2s}.nav a:hover,.nav a.active{color:#38bdf8}
.main-container{display:flex;height:calc(100vh - 73px)}
.sidebar{width:380px;background:#1e293b;border-right:1px solid #334155;display:flex;flex-direction:column;overflow:hidden;z-index:500}
.sidebar-header{padding:1.25rem;border-bottom:1px solid #334155}.sidebar-title{font-size:1.125rem;font-weight:600;margin-bottom:1rem}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem}
.stat-box{background:#0f172a;padding:.6rem;border-radius:8px;text-align:center}.stat-value{font-size:1.1rem;font-weight:700}.stat-value.total{color:#38bdf8}.stat-value.bid{color:#22c55e}.stat-value.review{color:#eab308}.stat-value.skip{color:#ef4444}.stat-label{font-size:.65rem;color:#64748b;margin-top:.2rem}
.filters{padding:1rem 1.25rem;border-bottom:1px solid #334155}
.filter-row{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.75rem}
.filter-btn{padding:.4rem .8rem;border-radius:16px;border:1px solid #334155;background:transparent;color:#94a3b8;cursor:pointer;font-size:.8rem;font-weight:500;transition:all .2s}
.filter-btn:hover{border-color:#38bdf8;color:#38bdf8}.filter-btn.active{background:#38bdf8;color:#0f172a;border-color:#38bdf8}
.filter-btn.bid.active{background:#22c55e;border-color:#22c55e}.filter-btn.review.active{background:#eab308;border-color:#eab308;color:#0f172a}.filter-btn.skip.active{background:#ef4444;border-color:#ef4444}
.date-filter{display:flex;gap:.5rem;align-items:center}
.date-filter select{background:#0f172a;border:1px solid #334155;color:#e2e8f0;padding:.4rem .6rem;border-radius:6px;font-size:.8rem;cursor:pointer}
.property-list{flex:1;overflow-y:auto;padding:.75rem}
.property-card{background:#0f172a;border-radius:10px;padding:.9rem;margin-bottom:.6rem;cursor:pointer;border:1px solid transparent;transition:all .2s}
.property-card:hover{border-color:#38bdf8;transform:translateX(4px)}.property-card.bid{border-left:4px solid #22c55e}.property-card.review{border-left:4px solid #eab308}.property-card.skip{border-left:4px solid #ef4444}
.property-address{font-weight:600;font-size:.85rem;margin-bottom:.4rem;color:#f1f5f9}.property-details{display:flex;justify-content:space-between;font-size:.75rem;color:#94a3b8}.property-judgment{color:#38bdf8;font-weight:600}
.property-recommendation{padding:.2rem .4rem;border-radius:4px;font-size:.65rem;font-weight:600}
.property-recommendation.bid{background:rgba(34,197,94,.2);color:#22c55e}.property-recommendation.review{background:rgba(234,179,8,.2);color:#eab308}.property-recommendation.skip{background:rgba(239,68,68,.2);color:#ef4444}
#map{flex:1;z-index:1}
/* Layer Control Styling */
.leaflet-control-layers{background:#1e293b!important;border:1px solid #334155!important;border-radius:8px!important;color:#e2e8f0!important;box-shadow:0 4px 12px rgba(0,0,0,.3)!important}
.leaflet-control-layers-toggle{background-color:#1e293b!important;width:36px!important;height:36px!important}
.leaflet-control-layers-list{padding:8px 12px!important}
.leaflet-control-layers-base label,.leaflet-control-layers-overlays label{color:#e2e8f0!important;margin-bottom:4px}
.leaflet-control-layers-separator{border-top:1px solid #334155!important}
/* Draw Control Styling */
.leaflet-draw-toolbar a{background-color:#1e293b!important;border:1px solid #334155!important;color:#e2e8f0!important}
.leaflet-draw-toolbar a:hover{background-color:#334155!important}
.leaflet-draw-actions{background:#1e293b!important;border:1px solid #334155!important}
.leaflet-draw-actions a{background:#0f172a!important;color:#e2e8f0!important;border:none!important}
.leaflet-draw-actions a:hover{background:#38bdf8!important;color:#0f172a!important}
/* Custom Map Controls */
.map-controls{position:absolute;top:90px;right:10px;z-index:1000;display:flex;flex-direction:column;gap:8px}
.map-control-btn{background:#1e293b;border:1px solid #334155;color:#e2e8f0;padding:10px 14px;border-radius:8px;cursor:pointer;font-size:.8rem;font-weight:500;display:flex;align-items:center;gap:6px;transition:all .2s;box-shadow:0 2px 8px rgba(0,0,0,.2)}
.map-control-btn:hover{background:#334155;border-color:#38bdf8}
.map-control-btn.active{background:#38bdf8;color:#0f172a;border-color:#38bdf8}
.map-control-btn svg{width:16px;height:16px}
/* Popup Styling */
.leaflet-popup-content-wrapper{background:#1e293b!important;color:#e2e8f0;border-radius:12px!important;box-shadow:0 8px 24px rgba(0,0,0,.4)!important}.leaflet-popup-tip{background:#1e293b!important}
.popup-content{min-width:300px;max-width:350px}.popup-title{font-weight:700;font-size:1rem;margin-bottom:.75rem;color:#f1f5f9}
.popup-photo{width:100%;height:180px;object-fit:cover;border-radius:8px;margin-bottom:.75rem;background:#0f172a}
.popup-row{display:flex;justify-content:space-between;padding:.5rem 0;border-bottom:1px solid #334155;font-size:.85rem}.popup-row:last-child{border-bottom:none}.popup-label{color:#64748b}.popup-value{font-weight:600;color:#f1f5f9}
.popup-rec{display:inline-block;padding:.35rem 1rem;border-radius:20px;font-weight:600;font-size:.85rem;margin-top:.75rem}
.popup-rec.bid{background:#22c55e;color:#052e16}.popup-rec.review{background:#eab308;color:#422006}.popup-rec.skip{background:#ef4444;color:#450a0a}
.popup-actions{display:flex;gap:.5rem;margin-top:1rem}
.popup-action-btn{flex:1;padding:.5rem;border-radius:6px;border:1px solid #334155;background:#0f172a;color:#e2e8f0;cursor:pointer;font-size:.75rem;font-weight:500;transition:all .2s}
.popup-action-btn:hover{border-color:#38bdf8;color:#38bdf8}
/* Draw Instructions */
.draw-instructions{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);background:#1e293b;border:1px solid #38bdf8;color:#e2e8f0;padding:12px 20px;border-radius:8px;font-size:.85rem;z-index:1000;display:none;box-shadow:0 4px 12px rgba(0,0,0,.3)}
.draw-instructions.show{display:block}
@media(max-width:768px){.main-container{flex-direction:column}.sidebar{width:100%;height:40%}#map{height:60%}.map-controls{top:10px;right:10px}}
</style>
</head>
<body>
<header class="header"><div class="logo"><div class="logo-icon">B</div><span class="logo-text">BidDeed.AI</span></div><nav class="nav"><a href="/agent">Agent</a><a href="/map" class="active">Map</a><a href="/chat">Chat</a><a href="/">Home</a></nav></header>
<div class="main-container">
<aside class="sidebar">
<div class="sidebar-header">
<h2 class="sidebar-title">üìç Brevard County Foreclosures</h2>
<div class="stats-grid">
<div class="stat-box"><div class="stat-value total" id="total-count">0</div><div class="stat-label">Total</div></div>
<div class="stat-box"><div class="stat-value bid" id="bid-count">0</div><div class="stat-label">BID</div></div>
<div class="stat-box"><div class="stat-value review" id="review-count">0</div><div class="stat-label">REVIEW</div></div>
<div class="stat-box"><div class="stat-value skip" id="skip-count">0</div><div class="stat-label">SKIP</div></div>
</div>
</div>
<div class="filters">
<div class="filter-row">
<button class="filter-btn active" data-filter="all">All</button>
<button class="filter-btn bid" data-filter="BID">‚úÖ BID</button>
<button class="filter-btn review" data-filter="REVIEW">‚ö†Ô∏è REVIEW</button>
<button class="filter-btn skip" data-filter="SKIP">‚ùå SKIP</button>
</div>
<div class="date-filter">
<span style="font-size:.75rem;color:#64748b">Auction:</span>
<select id="date-select">
<option value="all">All Dates</option>
<option value="2025-12-03">Dec 3, 2025</option>
<option value="2025-12-17">Dec 17, 2025</option>
<option value="2025-01-07">Jan 7, 2025</option>
</select>
</div>
</div>
<div class="property-list" id="property-list"></div>
</aside>
<div id="map"></div>
<div class="map-controls">
<button class="map-control-btn" id="toggle-satellite" title="Toggle Satellite View">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
Satellite
</button>
<button class="map-control-btn" id="toggle-draw" title="Draw Area to Search">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>
Draw Area
</button>
<button class="map-control-btn" id="clear-draw" title="Clear Selection" style="display:none">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
Clear
</button>
<button class="map-control-btn" id="export-csv" title="Export to CSV">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
Export
</button>
</div>
<div class="draw-instructions" id="draw-instructions">
üñäÔ∏è Click on the map to draw a polygon. Double-click to finish.
</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
<script>
// Real Brevard County foreclosure data
const DATA=[
{c:"05-2024-CA-024562",a:"8520 HIGHWAY 1, MICCO, FL 32976",y:"MICCO",lat:27.88,lng:-80.50,j:25550,m:16250,p:"Bank of NY Mellon",s:0.003,r:"SKIP",d:"2025-12-03"},
{c:"05-2024-CA-031234",a:"2085 ROBIN HOOD DR, MELBOURNE, FL 32935",y:"MELBOURNE",lat:28.1389,lng:-80.6247,j:176240,m:88120,p:"Bank of America",s:0.003,r:"SKIP",d:"2025-12-03",ph:"https://www.bcpao.us/photos/26/2610052011.jpg"},
{c:"05-2024-CA-031697",a:"1160 TIGER ST SE, PALM BAY, FL 32909",y:"PALM BAY",lat:27.92,lng:-80.65,j:253150,m:126575,p:"Nationstar Mortgage",s:0.003,r:"SKIP",d:"2025-12-03",ph:"https://www.bcpao.us/photos/29/2935858011.jpg"},
{c:"05-2022-CA-035649",a:"5600 GRAHAM ST, COCOA, FL 32927",y:"COCOA",lat:28.4736,lng:-80.7653,j:279230,m:161612,p:"US Bank NA",s:0.003,r:"REVIEW",d:"2025-12-03",ph:"https://www.bcpao.us/photos/24/2402095011.jpg"},
{c:"05-2024-CA-029012",a:"2450 PALM BAY RD NE, PALM BAY, FL 32905",y:"PALM BAY",lat:28.0344,lng:-80.5887,j:185000,m:147000,p:"Freedom Mortgage",s:0.99,r:"BID",d:"2025-12-03",ph:"https://www.bcpao.us/photos/28/2815672011.jpg"},
{c:"05-2024-CA-018884",a:"906 SHAW CIR, MELBOURNE, FL 32935",y:"MELBOURNE",lat:28.145,lng:-80.63,j:372130,m:186065,p:"Lakeview Loan Servicing",s:0.45,r:"REVIEW",d:"2025-12-03"},
{c:"05-2018-CA-050709",a:"4920 BROOKHAVEN ST, COCOA, FL 32927",y:"COCOA",lat:28.47,lng:-80.76,j:74346.63,m:52042,p:"MTGLQ INVEST",s:0.65,r:"REVIEW",d:"2025-12-17"},
{c:"05-2023-CA-044476",a:"2100 LEEWOOD BLVD, MELBOURNE, FL 32935",y:"MELBOURNE",lat:28.14,lng:-80.62,j:232556.89,m:162789,p:"NATIONSTAR",s:0.72,r:"REVIEW",d:"2025-12-17"},
{c:"05-2024-CA-014947",a:"808 EMERSON DR, PALM BAY, FL 32907",y:"PALM BAY",lat:27.9961,lng:-80.66,j:219655.37,m:175724,p:"LAKEVIEW LOAN",s:0.81,r:"BID",d:"2025-12-17"},
{c:"05-2024-CA-048653",a:"775 JACARANDA ST, MERRITT ISLAND, FL 32953",y:"MERRITT ISLAND",lat:28.3594,lng:-80.6823,j:110864.55,m:88691,p:"DATA MORTGAGE",s:0.78,r:"BID",d:"2025-12-17"},
{c:"05-2024-CA-051335",a:"1001 ORIOLE CIR, BAREFOOT BAY, FL 32976",y:"BAREFOOT BAY",lat:27.885,lng:-80.505,j:325000,m:227500,p:"EVELYN SIMEON",s:0.55,r:"REVIEW",d:"2025-12-17"},
{c:"05-2025-CA-013384",a:"2551 STRATFORD DR, COCOA, FL 32926",y:"COCOA",lat:28.3861,lng:-80.7428,j:166431.65,m:133145,p:"HUNTINGTON",s:0.82,r:"BID",d:"2025-12-17"},
{c:"05-2025-CA-017191",a:"3625 MIRIAM DR, TITUSVILLE, FL 32780",y:"TITUSVILLE",lat:28.6122,lng:-80.8076,j:334505.28,m:234153,p:"CITIZENS BANK",s:0.68,r:"REVIEW",d:"2025-12-17"},
{c:"05-2025-CA-022257",a:"923 SLOCUM ST, PALM BAY, FL 32909",y:"PALM BAY",lat:27.925,lng:-80.645,j:143880.65,m:115104,p:"US BANK",s:0.79,r:"BID",d:"2025-12-17"},
{c:"05-2025-CA-024879",a:"661 BRISBANE ST, PALM BAY, FL 32909",y:"PALM BAY",lat:27.918,lng:-80.652,j:281528.68,m:197070,p:"DATA MORT",s:0.71,r:"REVIEW",d:"2025-12-17"},
{c:"05-2025-CA-026675",a:"4461 LONGBOW DR, TITUSVILLE, FL 32780",y:"TITUSVILLE",lat:28.605,lng:-80.81,j:224779.39,m:179823,p:"NEWREZ",s:0.83,r:"BID",d:"2025-12-17"},
{c:"05-2025-CA-034578",a:"520 HOLMES AVE, PALM BAY, FL 32907",y:"PALM BAY",lat:27.99,lng:-80.665,j:268305.13,m:214644,p:"UNITED WHOLESALE",s:0.76,r:"BID",d:"2025-12-17"},
{c:"05-2025-CC-017102",a:"1404 PARADISE LN, COCOA, FL 32922",y:"COCOA",lat:28.35,lng:-80.74,j:24520,m:17164,p:"NORTHFIELD",s:0.42,r:"SKIP",d:"2025-12-17"},
{c:"05-2024-CA-045123",a:"1847 DOOLITTLE LN, TITUSVILLE, FL 32796",y:"TITUSVILLE",lat:28.5847,lng:-80.8156,j:287500,m:201250,p:"WELLS FARGO BANK NA",s:0.68,r:"REVIEW",d:"2025-01-07"},
{c:"05-2024-CA-045234",a:"925 ATLANTUS TER, SATELLITE BEACH, FL 32937",y:"SATELLITE BEACH",lat:28.1762,lng:-80.5901,j:425000,m:340000,p:"NATIONSTAR MORTGAGE LLC",s:0.85,r:"BID",d:"2025-01-07"},
{c:"05-2024-CA-045567",a:"4521 N ATLANTIC AVE, COCOA BEACH, FL 32931",y:"COCOA BEACH",lat:28.32,lng:-80.6076,j:520000,m:416000,p:"JPMORGAN CHASE BANK NA",s:0.82,r:"BID",d:"2025-01-07"},
{c:"05-2024-CA-045789",a:"987 VIERA BLVD, VIERA, FL 32940",y:"VIERA",lat:28.2558,lng:-80.7321,j:485000,m:388000,p:"LOANCARE LLC",s:0.85,r:"BID",d:"2025-01-07"}
];

// Initialize map with layer options
const streets = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
  attribution: '¬© OpenStreetMap ¬© CARTO', maxZoom: 19
});

const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
  attribution: '¬© Esri', maxZoom: 19
});

const map = L.map('map', {
  center: [28.2639, -80.7214],
  zoom: 10,
  layers: [streets]
});

// Layer control
const baseMaps = { "Streets": streets, "Satellite": satellite };
L.control.layers(baseMaps, null, { position: 'topleft' }).addTo(map);

// Draw control
const drawnItems = new L.FeatureGroup();
map.addLayer(drawnItems);

const drawControl = new L.Control.Draw({
  position: 'topleft',
  draw: {
    polygon: { allowIntersection: false, shapeOptions: { color: '#38bdf8', fillOpacity: 0.2 } },
    rectangle: { shapeOptions: { color: '#38bdf8', fillOpacity: 0.2 } },
    circle: false, marker: false, polyline: false, circlemarker: false
  },
  edit: { featureGroup: drawnItems, remove: true }
});

let drawEnabled = false;
let markers = [];
let currentFilter = 'all';
let currentDate = 'all';
let isSatellite = false;
let drawnArea = null;

const colors = { BID: '#22c55e', REVIEW: '#eab308', SKIP: '#ef4444' };

// Popup template
function popup(p) {
  const ph = p.ph ? `<img src="${p.ph}" class="popup-photo" onerror="this.style.display='none'" alt="Property Photo">` : '';
  return `<div class="popup-content">
    <div class="popup-title">${p.a}</div>
    ${ph}
    <div class="popup-row"><span class="popup-label">Case #</span><span class="popup-value">${p.c}</span></div>
    <div class="popup-row"><span class="popup-label">Judgment</span><span class="popup-value">$${p.j?.toLocaleString() || 'N/A'}</span></div>
    <div class="popup-row"><span class="popup-label">Max Bid</span><span class="popup-value">$${p.m?.toLocaleString() || 'N/A'}</span></div>
    <div class="popup-row"><span class="popup-label">BidDeed ML Score</span><span class="popup-value">${(p.s * 100).toFixed(0)}%</span></div>
    <div class="popup-row"><span class="popup-label">Plaintiff</span><span class="popup-value">${p.p || 'Unknown'}</span></div>
    <div class="popup-row"><span class="popup-label">Auction Date</span><span class="popup-value">${p.d}</span></div>
    <div style="text-align:center"><span class="popup-rec ${p.r.toLowerCase()}">${p.r}</span></div>
    <div class="popup-actions">
      <button class="popup-action-btn" onclick="window.open('https://www.google.com/maps?q=${p.lat},${p.lng}','_blank')">üìç Google Maps</button>
      <button class="popup-action-btn" onclick="window.open('https://www.bcpao.us/PropertySearch/#/account/${p.c.split('-')[3]}','_blank')">üèõÔ∏è BCPAO</button>
    </div>
  </div>`;
}

// Filter data
function filterData() {
  let data = DATA;
  if (currentFilter !== 'all') data = data.filter(p => p.r === currentFilter);
  if (currentDate !== 'all') data = data.filter(p => p.d === currentDate);
  if (drawnArea) {
    data = data.filter(p => drawnArea.contains(L.latLng(p.lat, p.lng)));
  }
  return data;
}

// Render map and list
function render() {
  markers.forEach(m => map.removeLayer(m));
  markers = [];
  const list = document.getElementById('property-list');
  list.innerHTML = '';
  
  const data = filterData();
  
  // Update stats
  document.getElementById('total-count').textContent = data.length;
  document.getElementById('bid-count').textContent = data.filter(p => p.r === 'BID').length;
  document.getElementById('review-count').textContent = data.filter(p => p.r === 'REVIEW').length;
  document.getElementById('skip-count').textContent = data.filter(p => p.r === 'SKIP').length;
  
  data.forEach(p => {
    const mk = L.circleMarker([p.lat, p.lng], {
      radius: 12, fillColor: colors[p.r], color: '#fff', weight: 2, opacity: 1, fillOpacity: 0.85
    }).addTo(map);
    mk.bindPopup(popup(p), { maxWidth: 380 });
    markers.push(mk);
    
    const card = document.createElement('div');
    card.className = `property-card ${p.r.toLowerCase()}`;
    card.innerHTML = `
      <div class="property-address">${p.a}</div>
      <div class="property-details">
        <span class="property-judgment">$${p.j?.toLocaleString() || 'N/A'}</span>
        <span class="property-recommendation ${p.r.toLowerCase()}">${p.r}</span>
      </div>
      <div class="property-details" style="margin-top:.4rem">
        <span>${p.d}</span>
        <span>ML: ${(p.s * 100).toFixed(0)}%</span>
      </div>`;
    card.onclick = () => { map.setView([p.lat, p.lng], 15); mk.openPopup(); };
    list.appendChild(card);
  });
}

// Filter buttons
document.querySelectorAll('.filter-btn').forEach(b => {
  b.onclick = () => {
    document.querySelectorAll('.filter-btn').forEach(x => x.classList.remove('active'));
    b.classList.add('active');
    currentFilter = b.dataset.filter;
    render();
  };
});

// Date filter
document.getElementById('date-select').onchange = (e) => {
  currentDate = e.target.value;
  render();
};

// Satellite toggle
document.getElementById('toggle-satellite').onclick = function() {
  isSatellite = !isSatellite;
  if (isSatellite) {
    map.removeLayer(streets);
    map.addLayer(satellite);
    this.classList.add('active');
    this.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg> Streets';
  } else {
    map.removeLayer(satellite);
    map.addLayer(streets);
    this.classList.remove('active');
    this.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg> Satellite';
  }
};

// Draw toggle
document.getElementById('toggle-draw').onclick = function() {
  drawEnabled = !drawEnabled;
  if (drawEnabled) {
    map.addControl(drawControl);
    this.classList.add('active');
    document.getElementById('draw-instructions').classList.add('show');
  } else {
    map.removeControl(drawControl);
    this.classList.remove('active');
    document.getElementById('draw-instructions').classList.remove('show');
  }
};

// Clear drawn area
document.getElementById('clear-draw').onclick = function() {
  drawnItems.clearLayers();
  drawnArea = null;
  this.style.display = 'none';
  render();
};

// Draw events
map.on(L.Draw.Event.CREATED, function(e) {
  drawnItems.clearLayers();
  drawnItems.addLayer(e.layer);
  drawnArea = e.layer.getBounds();
  document.getElementById('clear-draw').style.display = 'flex';
  document.getElementById('draw-instructions').classList.remove('show');
  render();
});

// Export CSV
document.getElementById('export-csv').onclick = function() {
  const data = filterData();
  const headers = ['Case#', 'Address', 'City', 'Judgment', 'MaxBid', 'MLScore', 'Plaintiff', 'Recommendation', 'AuctionDate'];
  const rows = data.map(p => [p.c, `"${p.a}"`, p.y, p.j, p.m, p.s, `"${p.p}"`, p.r, p.d].join(','));
  const csv = [headers.join(','), ...rows].join('\n');
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `biddeed-foreclosures-${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  URL.revokeObjectURL(url);
};

// Initial render
render();
console.log('BidDeed.AI Map V2 - Loaded ' + DATA.length + ' properties');
</script>
</body>
</html>
