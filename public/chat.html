<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BidDeed.AI - Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0a0f;--bg2:#12121a;--bg3:#1a1a24;--border:#2a2a3a;--text:#f0f0f5;--text2:#8888a0;--accent:#38bdf8;--purple:#a78bfa;--success:#22c55e;--warn:#eab308;--error:#ef4444}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column}
.header{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1.5rem;background:var(--bg2);border-bottom:1px solid var(--border);height:60px;flex-shrink:0}
.logo{display:flex;align-items:center;gap:.75rem}.logo-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--accent),var(--purple));border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700}
.logo-text{font-size:1.25rem;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.badge{font-size:.65rem;padding:.2rem .5rem;background:rgba(56,189,248,.1);color:var(--accent);border-radius:4px;font-weight:600;margin-left:.5rem}
.nav{display:flex;gap:1rem}.nav a{color:var(--text2);text-decoration:none;font-size:.875rem;font-weight:500;padding:.5rem .75rem;border-radius:6px;transition:all .2s}.nav a:hover{color:var(--text);background:var(--bg3)}.nav a.active{color:var(--accent)}
.chat-container{flex:1;display:flex;flex-direction:column;max-width:900px;margin:0 auto;width:100%;padding:0 1rem}
.messages{flex:1;overflow-y:auto;padding:1.5rem 0;display:flex;flex-direction:column;gap:1rem}
.message{max-width:85%;padding:1rem 1.25rem;border-radius:16px;line-height:1.6;font-size:.95rem;animation:fadeIn .3s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.message.user{background:linear-gradient(135deg,var(--accent),var(--purple));color:white;align-self:flex-end;border-bottom-right-radius:4px}
.message.assistant{background:var(--bg2);border:1px solid var(--border);align-self:flex-start;border-bottom-left-radius:4px}
.message.assistant h3{font-size:1rem;margin-bottom:.5rem;color:var(--accent)}
.message.assistant ul{margin:.5rem 0;padding-left:1.25rem}
.message.assistant li{margin:.25rem 0}
.message.assistant strong{color:var(--accent)}
.message.assistant code{background:var(--bg3);padding:.15rem .4rem;border-radius:4px;font-family:'JetBrains Mono',monospace;font-size:.85rem}
.typing{display:flex;gap:4px;padding:1rem}.typing span{width:8px;height:8px;background:var(--text2);border-radius:50%;animation:bounce .6s infinite alternate}
.typing span:nth-child(2){animation-delay:.2s}.typing span:nth-child(3){animation-delay:.4s}
@keyframes bounce{to{transform:translateY(-6px);opacity:.5}}
.input-area{padding:1rem 0 1.5rem;border-top:1px solid var(--border)}
.input-wrapper{display:flex;gap:.75rem;background:var(--bg2);border:1px solid var(--border);border-radius:16px;padding:.5rem;transition:border-color .2s}
.input-wrapper:focus-within{border-color:var(--accent)}
#chatInput{flex:1;background:none;border:none;color:var(--text);font-size:1rem;padding:.5rem 1rem;outline:none;font-family:'Inter',sans-serif;resize:none;min-height:24px;max-height:120px}
#chatInput::placeholder{color:var(--text2)}
.send-btn{width:44px;height:44px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--accent),var(--purple));color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .2s,opacity .2s;font-size:1.25rem}
.send-btn:hover{transform:scale(1.05)}.send-btn:active{transform:scale(.95)}.send-btn:disabled{opacity:.5;cursor:not-allowed}
.suggestions{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem}
.suggestion{background:var(--bg2);border:1px solid var(--border);color:var(--text2);padding:.5rem 1rem;border-radius:20px;font-size:.85rem;cursor:pointer;transition:all .2s}
.suggestion:hover{border-color:var(--accent);color:var(--accent);background:rgba(56,189,248,.05)}
@media(max-width:640px){.nav{display:none}.message{max-width:95%}.suggestions{flex-direction:column}.suggestion{text-align:center}}
</style>
</head>
<body>
<header class="header">
<div class="logo"><div class="logo-icon">ðŸ’¬</div><span class="logo-text">BidDeed.AI</span><span class="badge">CHAT</span></div>
<nav class="nav"><a href="/map">Map</a><a href="/agent">Agent</a><a href="/chat" class="active">Chat</a></nav>
</header>

<div class="chat-container">
<div class="messages" id="messages">
<div class="message assistant">
<h3>ðŸ‘‹ Welcome to BidDeed.AI</h3>
<p>I'm your AI foreclosure research assistant for Brevard County. I can help you with:</p>
<ul>
<li>Analyzing upcoming foreclosure auctions</li>
<li>Property valuations and max bid calculations</li>
<li>Lien searches and title research</li>
<li>Market comparables and ARV estimates</li>
</ul>
<p>What would you like to know?</p>
</div>
</div>

<div class="input-area">
<div class="suggestions">
<button class="suggestion" onclick="sendSuggestion(this)">What auctions are coming up?</button>
<button class="suggestion" onclick="sendSuggestion(this)">Calculate max bid for a property</button>
<button class="suggestion" onclick="sendSuggestion(this)">Search liens by address</button>
<button class="suggestion" onclick="sendSuggestion(this)">Market trends in Satellite Beach</button>
</div>
<div class="input-wrapper">
<textarea id="chatInput" placeholder="Ask about Brevard foreclosures..." rows="1" onkeydown="handleKeyDown(event)"></textarea>
<button class="send-btn" onclick="sendMessage()" id="sendBtn">âž¤</button>
</div>
</div>
</div>

<script>
const msgs = document.getElementById('messages');
const input = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');

// Auto-resize textarea
input.addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 120) + 'px';
});

function handleKeyDown(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

function sendSuggestion(btn) {
  input.value = btn.textContent;
  sendMessage();
}

async function sendMessage() {
  const text = input.value.trim();
  if (!text) return;
  
  // Add user message
  addMessage(text, 'user');
  input.value = '';
  input.style.height = 'auto';
  
  // Hide suggestions after first message
  document.querySelector('.suggestions').style.display = 'none';
  
  // Show typing indicator
  const typing = document.createElement('div');
  typing.className = 'message assistant';
  typing.innerHTML = '<div class="typing"><span></span><span></span><span></span></div>';
  msgs.appendChild(typing);
  msgs.scrollTop = msgs.scrollHeight;
  
  try {
    const response = await fetch('/api/chat', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({message: text})
    });
    
    const data = await response.json();
    typing.remove();
    addMessage(data.response || data.message || 'I received your message. Let me analyze that for you.', 'assistant');
  } catch (error) {
    typing.remove();
    addMessage('I apologize, but I encountered an error connecting to the server. Please try again.', 'assistant');
  }
}

function addMessage(text, type) {
  const div = document.createElement('div');
  div.className = `message ${type}`;
  
  if (type === 'assistant') {
    // Parse markdown-like formatting
    text = text
      .replace(/## (.*?)(\n|$)/g, '<h3>$1</h3>')
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/`(.*?)`/g, '<code>$1</code>')
      .replace(/\n/g, '<br>');
  }
  
  div.innerHTML = text;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}
</script>
</body>
</html>
